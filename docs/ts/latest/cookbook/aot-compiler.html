<!DOCTYPE html><html lang="en" ng-app="angularIOApp" itemscope itemtype="http://schema.org/Framework"><!-- template: public/docs/_layout--><head><title>Ahead-of-Time Compilation - ts - COOKBOOK</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Angular is a development platform for building mobile and desktop web applications"/><meta name="keywords" content="Angular, AngularJS, AngularDart, Javscript, Dart, Framework, JavaScript MVC, Google"/><meta name="robots" content="all"/><meta name="referrer" content="origin"/><meta name="viewport" id="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="Angular"/><meta property="og:image" content="/resources/images/logos/standard/shield-large.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="184"/><meta property="og:image:height" content="200"/><meta property="og:description" content="Angular is a development platform for building mobile and desktop web applications"/><meta itemprop="name" content="Angular"/><meta itemprop="description" content="Angular is a development platform for building mobile and desktop web applications"/><meta itemprop="image" content="https://angular.io/resources/images/logos/standard/shield-large.png"/><link rel="icon" type="image/x-icon" href="/resources/images/icons/favicon.ico"/><link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.css"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,300,500,400italic,700" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/><link rel="stylesheet" href="/resources/css/vendor/icomoon/style.css"/><link rel="stylesheet" href="/resources/css/vendor/animate.css"/><link rel="stylesheet" href="/resources/css/main.css"/><!-- MOBILE ICONS -->
<link rel="apple-touch-icon" sizes="57x57" href="/resources/images/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/resources/images/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/resources/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/resources/images/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/resources/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/resources/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/resources/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/resources/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/resources/images/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/resources/images/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/resources/images/favicons/manifest.json"></head><body ng-controller="AppCtrl as appCtrl" class="l-offset-nav l-offset-side-nav"><nav data-swiftype-index="false" scroll-y-offset-element="scroll-y-offset-element" class="main-nav l-pinned-top l-layer-5"><h1><a href="/" md-button>Angular <sup>by Google</sup></a></h1><button aria-label="View Menu" ng-click="appCtrl.toggleMainMenu($event)" md-button="md-button" class="main-nav-button main-nav-mobile-trigger l-right">Site Menu <span class="icon icon-arrow-drop-down"></span></button><ul ng-class="appCtrl.showMainNav ? 'is-visible' : ''"><li class="l-left"><a class="main-nav-button" href="/features.html" md-button>Features</a></li><li class="l-left"><a class="main-nav-button" href="/docs/ts/latest/" md-button>Docs</a></li><li class="l-left"><a class="main-nav-button" href="/events.html" md-button>Events</a></li><li class="l-right"><a class="main-nav-button" href="/docs/ts/latest/quickstart.html" md-button>Get Started</a></li></ul></nav><!-- Include this file ONLY when current.path[2] is defined--><nav data-swiftype-index="false" ng-class="appCtrl.showDocsNav ? 'is-visible' : ''" class="sidenav l-pinned-left l-layer-4 l-offset-nav"><!-- SEARCH BAR--><header class="sidenav-search st-input-wrapper"><div class="st-input-inner"><label for="search-io" class="is-hidden">Search Docs</label><input type="text" placeholder="SEARCH DOCS..." class="st-default-search-input"/></div><button aria-label="View Docs Menu" ng-click="appCtrl.toggleDocsMenu($event)" md-button="md-button" class="mobile-trigger button">Docs <span class="icon icon-arrow-drop-down"></span></button></header><ul class="sidenav-links"><li class="sidenav-section no-border"><a href="/docs/ts/latest/" class="nav-title">Docs Home</a></li><!-- CORE DOCUMENTATION--><li class="sidenav-section-divider"><h3>Core Documentation</h3></li><li class="sidenav-section"><a href="/docs/ts/latest/quickstart.html" title="Quickstart" class="nav-title ">Quickstart</a></li><li class="sidenav-section"><a href="/docs/ts/latest/cli-quickstart.html" title="CLI Quickstart" class="nav-title ">CLI Quickstart</a></li><li class="sidenav-section"><a href="/docs/ts/latest/guide/" title="How to read and use this documentation." class="nav-title is-parent ">Guide<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-ordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/guide/" title="How to read and use this documentation.">1. Overview</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/setup.html" title="Install the Angular QuickStart seed for faster, more efficient development on your machine.">2. Setup</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/learning-angular.html" title="A suggested path through the documentation for Angular newcomers.">3. Learning Angular</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/architecture.html" title="The basic building blocks of Angular applications.">4. Architecture</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/appmodule.html" title="Tell Angular how to construct and bootstrap the app in the root &quot;AppModule&quot;.">5. The Root Module</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/displaying-data.html" title="Property binding helps show app data in the UI.">6. Displaying Data</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/user-input.html" title="User input triggers DOM events. We listen to those events with event bindings that funnel updated values back into our components and models.">7. User Input</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/forms.html" title="A form creates a cohesive, effective, and compelling data entry experience. An Angular form coordinates a set of data-bound user controls, tracks changes, validates input, and presents errors.">8. Forms</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/dependency-injection.html" title="Angular's dependency injection system creates and delivers dependent services &quot;just-in-time&quot;.">9. Dependency Injection</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/template-syntax.html" title="Learn how to write templates that display data and consume user events with the help of data binding.">10. Template Syntax</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/cheatsheet.html" title="Cheat Sheet">11. Cheat Sheet</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/style-guide.html" title="Write Angular with style.">12. Style Guide</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/glossary.html" title="Brief definitions of the most important words in the Angular vocabulary.">13. Glossary</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/change-log.html" title="An annotated history of recent documentation improvements.">14. Change Log</a></li></ul></div></li><li class="sidenav-section no-border"><a href="/docs/ts/latest/api/" title="API Reference" class="nav-title ">API Reference</a></li><!-- ADVANCED DOCUMENATION--><li class="sidenav-section-divider"><h3>Additional Documentation</h3></li><li class="sidenav-section"><a href="/docs/ts/latest/tutorial/" title="The Tour of Heroes tutorial takes you through the steps of creating an Angular application in TypeScript." class="nav-title is-parent ">Tutorial<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-ordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/" title="The Tour of Heroes tutorial takes you through the steps of creating an Angular application in TypeScript.">1. Introduction</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt1.html" title="We build a simple hero editor.">2. The Hero Editor</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt2.html" title="We build a master/detail page with a list of heroes.">3. Master/Detail</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt3.html" title="We refactor the master/detail view into separate components.">4. Multiple Components</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt4.html" title="We create a reusable service to manage our hero data calls.">5. Services</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt5.html" title="We add the Angular Router and learn to navigate among the views.">6. Routing</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt6.html" title="We convert our service and components to use Angular's HTTP service.">7. HTTP</a></li></ul></div></li><li class="sidenav-section"><a href="/docs/ts/latest/guide/animations.html" title="A guide to Angular's animation system." class="nav-title is-parent ">Advanced<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-unordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/guide/animations.html" title="A guide to Angular's animation system.">Animations</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/attribute-directives.html" title="Attribute directives attach behavior to elements.">Attribute Directives</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/browser-support.html" title="Browser support and polyfills guide.">Browser support</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/component-styles.html" title="Learn how to apply CSS styles to components.">Component Styles</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/deployment.html" title="Learn how to deploy your Angular app.">Deployment</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/hierarchical-dependency-injection.html" title="Angular's hierarchical dependency injection system supports nested injectors in parallel with the component tree.">Hierarchical Injectors</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/reactive-forms.html" title="Create a reactive form using FormBuilder, groups, and arrays.">Reactive Forms</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/server-communication.html" title="Use an HTTP Client to talk to a remote server.">HTTP Client</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/lifecycle-hooks.html" title="Angular calls lifecycle hook methods on directives and components as it creates, changes, and destroys them.">Lifecycle Hooks</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/ngmodule.html" title="Define application modules with @NgModule.">NgModules</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/npm-packages.html" title="Recommended npm packages, and how to specify package dependencies.">Npm Packages</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/pipes.html" title="Pipes transform displayed values within a template.">Pipes</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/router.html" title="Discover the basics of screen navigation with the Angular Router.">Routing &amp; Navigation</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/security.html" title="Developing for content security in Angular applications.">Security</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/setup-systemjs-anatomy.html" title="Inside the local development environment for SystemJS.">Setup Anatomy</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/structural-directives.html" title="Angular has a powerful template engine that lets us easily manipulate the DOM structure of our elements.">Structural Directives</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/testing.html" title="Techniques and practices for testing an Angular app.">Testing</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/typescript-configuration.html" title="TypeScript configuration for Angular developers.">TypeScript Configuration</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/upgrade.html" title="Incrementally upgrade an AngularJS application to Angular.">Upgrading from AngularJS</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/webpack.html" title="Create Angular applications with a Webpack based tooling.">Webpack: an introduction</a></li></ul></div></li><li class="sidenav-section"><a href="/docs/ts/latest/cookbook/" title="A collection of recipes for common Angular application scenarios." class="nav-title is-parent is-selected">Cookbook<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-unordered-lists"><ul><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/" title="A collection of recipes for common Angular application scenarios.">Overview</a></li><li class="nav-list-item is-selected"><a href="/docs/ts/latest/cookbook/aot-compiler.html" title="Learn how to use Ahead-of-time compilation.">Ahead-of-Time Compilation</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/ajs-quick-reference.html" title="Learn how AngularJS concepts and techniques map to Angular.">AngularJS to Angular</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/component-communication.html" title="Share information between different directives and components.">Component Interaction</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/dependency-injection.html" title="Techniques for Dependency Injection.">Dependency Injection</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/dynamic-component-loader.html" title="Load components dynamically.">Dynamic Component Loader</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/dynamic-form.html" title="Render dynamic forms with FormGroup.">Dynamic Forms</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/form-validation.html" title="Validate user's form entries.">Form Validation</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/i18n.html" title="Translate the app's template text into multiple languages.">Internationalization (i18n)</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/ngmodule-faq.html" title="Answers to frequently asked questions about @NgModule.">NgModule FAQs</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/set-document-title.html" title="Setting the document or window title using the Title service.">Set the Document Title</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/ts-to-js.html" title="Convert Angular TypeScript examples into ES6 and ES5 JavaScript.">TypeScript to JavaScript</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/visual-studio-2015.html" title="Use Visual Studio 2015 with the QuickStart files.">Visual Studio 2015 QuickStart</a></li></ul></div></li></ul><nav class="dropdown"><button aria-label="Select a version of Angular" md-button="md-button" ng-click="appCtrl.toggleVersionMenu($event)" class="dropdown-button">Angular for TypeScript  <span class="icon icon-arrow-drop-down"></span></button><div ng-click="appCtrl.toggleVersionMenu($event)" ng-show="appCtrl.showMenu" class="overlay ng-hide"></div><ul ng-class="appCtrl.showMenu ? 'is-visible' : ''" class="dropdown-menu"><li><a href="/docs/ts/latest/cookbook/aot-compiler.html" md-button>Angular for TypeScript </a></li><li><a href="/docs/js/latest/cookbook/aot-compiler.html" md-button>Angular for JavaScript </a></li></ul></nav></nav><script>// Could put in appCtrl but only needed here and clear here
(function scrollToSelectedLink() {
  var sideNav = document.getElementsByClassName('sidenav')[0];
  var link = sideNav.getElementsByClassName('is-selected')[0];
  if(link && link.offsetTop > window.innerHeight){
    sideNav.scrollTop = link.offsetTop - (window.innerHeight/2);
    //alert("offsetTop: " + link.offsetTop + " side-nav top is " + sideNav.scrollTop);
  }
})()</script><header class="hero background-sky"><h1 class="hero-title ">Ahead-of-Time Compilation </h1><div class="clear"></div></header><div class="banner"><p class="text-body">Learn how to use Ahead-of-time compilation.</p></div><article class="l-content-small grid-fluid docs-content"><script>function why(id, backTo) {
  var id = "#"+id;
  var el = document.querySelector(id);
  el.hidden=el.hidden=!el.hidden;

  if (el.hidden && backTo){
    // the next line is required to work around a bug in WebKit (Chrome / Safari)
    location.href = "#";
    location.href =  "#" + backTo;
  }
}</script><script>function verbose(isVerbose) {
  isVerbose = !! isVerbose;
  var el = document.querySelector('button.verbose.off');
  el.style.display = isVerbose ? 'block' : 'none';
  var el = document.querySelector('button.verbose.on');
  el.style.display = isVerbose ? 'none' : 'block';

  CCSStylesheetRuleStyle('main','.l-verbose-section', 'display',
    isVerbose ? 'block' : 'none');
}
</script><script>function CCSStylesheetRuleStyle(stylesheet, selectorText, style, value){
  /* returns the value of the element style of the rule in the stylesheet
  *  If no value is given, reads the value
  *  If value is given, the value is changed and returned
  *  If '' (empty string) is given, erases the value.
  *  The browser will apply the default one
  *
  * string stylesheet: part of the .css name to be recognized, e.g. 'default'
  * string selectorText: css selector, e.g. '#myId', '.myClass', 'thead td'
  * string style: camelCase element style, e.g. 'fontSize'
  * string value optional : the new value
  */
  var CCSstyle = undefined, rules, sheet;
  for(var m in document.styleSheets){
    sheet = document.styleSheets[m];
    if(sheet.href && sheet.href.indexOf(stylesheet) != -1){
    rules = sheet[document.all ? 'rules' : 'cssRules'];
    for(var n in rules){
      console.log(rules[n].selectorText);
      if(rules[n].selectorText == selectorText){
        CCSstyle = rules[n].style;
        break;
      }
    }
    break;
    }
  }
  if(value == undefined)
    return CCSstyle[style]
  else
    return CCSstyle[style] = value
}
</script><p>This cookbook describes how to radically improve performance by compiling <em>Ahead of Time</em> (AOT)
during a build process.</p>
<a id="toc"></a><h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#aot-jit"><em>Ahead-of-Time</em> vs <em>Just-in-Time</em></a></li>
<li><a href="#compile">Compile with AOT</a></li>
<li><a href="#bootstrap">Bootstrap</a></li>
<li><a href="#tree-shaking">Tree Shaking</a></li>
<li><a href="#load">Load the bundle</a></li>
<li><a href="#serve">Serve the app</a></li>
<li><a href="#workflow">Workflow and convenience script</a></li>
<li><a href="#source-code">Source Code</a></li>
<li><a href="#toh">Tour of Heroes</a></li>
</ul>
<a id="overview"></a><div class="l-main-section"></div><h2 id="overview">Overview</h2>
<p>An Angular application consist largely of components and their HTML templates.
Before the browser can render the application,
the components and templates must be converted to executable JavaScript by the <em>Angular compiler</em>.</p>
<div class="l-sub-section"><p><a href="https://www.youtube.com/watch?v=kW9cJsvcsGo" target="_blank">Watch compiler author Tobias Bosch explain the Angular Compiler</a> at AngularConnect 2016.</p>
</div><p>You can compile the app in the browser, at runtime, as the application loads, using the <strong><em>Just-in-Time</em> (JIT) compiler</strong>.
This is the standard development approach shown throughout the documentation.
It&#39;s great .. but it has shortcomings.</p>
<p>JIT compilation incurs a runtime performance penalty.
Views take longer to render because of the in-browser compilation step.
The application is bigger because it includes the Angular compiler
and a lot of library code that the application won&#39;t actually need.
Bigger apps take longer to transmit and are slower to load.</p>
<p>Compilation can uncover many component-template binding errors.
JIT compilation discovers them at runtime which is later than we&#39;d like.</p>
<p>The <strong><em>Ahead-of-Time</em> (AOT) compiler</strong> can catch template errors early and improve performance
by compiling at build time as you&#39;ll learn in this chapter.</p>
<a id="aot-jit"></a><div class="l-main-section"></div><h2 id="_ahead-of-time_-aot-vs-_just-in-time_-jit-"><em>Ahead-of-time</em> (AOT) vs <em>Just-in-time</em> (JIT)</h2>
<p>There is actually only one Angular compiler. The difference between AOT and JIT is a matter of timing and tooling.
With AOT, the compiler runs once at build time using one set of libraries;
With JIT it runs every time for every user at runtime using a different set of libraries.</p>
<h3 id="why-do-aot-compilation-">Why do AOT compilation?</h3>
<p><em>Faster rendering</em></p>
<p>With AOT, the browser downloads a pre-compiled version of the application.
The browser loads executable code so it can render the application immediately, without waiting to compile the app first.</p>
<p><em>Fewer asynchronous requests</em></p>
<p>The compiler <em>inlines</em> external html templates and css style sheets within the application JavaScript,
eliminating separate ajax requests for those source files.</p>
<p><em>Smaller Angular framework download size</em></p>
<p>There&#39;s no need to download the Angular compiler if the app is already compiled.
The compiler is roughly half of Angular itself, so omitting it dramatically reduces the application payload.</p>
<p><em>Detect template errors earlier</em></p>
<p>The AOT compiler detects and reports template binding errors during the build step
before users can see them.</p>
<p><em>Better security</em></p>
<p>AOT compiles HTML templates and components into JavaScript files long before they are served to the client.
With no templates to read and no risky client-side HTML or JavaScript evaluation,
there are fewer opportunities for injection attacks.</p>
<a id="compile"></a><div class="l-main-section"></div><h2 id="compile-with-aot">Compile with AOT</h2>
<h3 id="prepare-for-offline-compilation">Prepare for offline compilation</h3>
<p>Take the <a href="../guide/setup.html">Setup</a> as a starting point.
A few minor changes to the lone <code>app.component</code> lead to these two class and html files:</p>
<code-tabs><code-pane language="html" name="src/app/app.component.html" format=".">&lt;button (click)=&quot;toggleHeading()&quot;&gt;Toggle Heading&lt;/button&gt;
&lt;h1 *ngIf=&quot;showHeading&quot;&gt;Hello Angular&lt;/h1&gt;

&lt;h3&gt;List of Heroes&lt;/h3&gt;
&lt;div *ngFor=&quot;let hero of heroes&quot;&gt;{{hero}}&lt;/div&gt;
</code-pane><code-pane language="ts" name="src/app/app.component.ts" format=".">import { Component } from &#39;@angular/core&#39;;

@Component({
  selector: &#39;my-app&#39;,
  templateUrl: &#39;./app.component.html&#39;
})
export class AppComponent {
  showHeading = true;
  heroes = [&#39;Magneta&#39;, &#39;Bombasto&#39;, &#39;Magma&#39;, &#39;Tornado&#39;];

  toggleHeading() {
    this.showHeading = !this.showHeading;
  }
}
</code-pane></code-tabs><p>Install a few new npm dependencies with the following command:</p>
<code-example language="none" class="code-shell">npm install @angular/compiler-cli @angular/platform-server --save</code-example><p>You will run the <code>ngc</code> compiler provided in the <code>@angular/compiler-cli</code> npm package
instead of the TypeScript compiler (<code>tsc</code>).</p>
<p><code>ngc</code> is a drop-in replacement for <code>tsc</code> and is configured much the same way.</p>
<p><code>ngc</code> requires its own <code>tsconfig.json</code> with AOT-oriented settings.
Copy the original <code>src/tsconfig.json</code> to a file called <code>tsconfig-aot.json</code> (on the project root),
then modify it to look as follows.</p>
<div class="code-example"><header><h4>tsconfig-aot.json</h4></header><code-example language="json" format="">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;es2015&quot;,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;sourceMap&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;lib&quot;: [&quot;es2015&quot;, &quot;dom&quot;],
    &quot;noImplicitAny&quot;: true,
    &quot;suppressImplicitAnyIndexErrors&quot;: true
  },

  &quot;files&quot;: [
    &quot;src/app/app.module.ts&quot;,
    &quot;src/main.ts&quot;
  ],

  &quot;angularCompilerOptions&quot;: {
   &quot;genDir&quot;: &quot;aot&quot;,
   &quot;skipMetadataEmit&quot; : true
 }
}
</code-example></div><p>The <code>compilerOptions</code> section is unchanged except for one property.
<strong>Set the <code>module</code> to <code>es2015</code></strong>.
This is important as explained later in the <a href="#tree-shaking">Tree Shaking</a> section.</p>
<p>What&#39;s really new is the <code>ngc</code> section at the bottom called <code>angularCompilerOptions</code>.
Its <code>&quot;genDir&quot;</code> property tells the compiler
to store the compiled output files in a new <code>aot</code> folder.</p>
<p>The <code>&quot;skipMetadataEmit&quot; : true</code> property prevents the compiler from generating metadata files with the compiled application.
Metadata files are not necessary when targeting TypeScript files, so there is no reason to include them.</p>
<p><strong><em>Component-relative Template URLS</em></strong></p>
<p>The AOT compiler requires that <code>@Component</code> URLS for external templates and css files be <em>component-relative</em>.
That means that the value of <code>@Component.templateUrl</code> is a URL value <em>relative</em> to the component class file.
For example, an <code>&#39;app.component.html&#39;</code> URL means that the template file is a sibling of its companion <code>app.component.ts</code> file.</p>
<p>While JIT app URLs are more flexible, stick with <em>component-relative</em> URLs for compatibility with AOT compilation.</p>
<h3 id="compiling-the-application">Compiling the application</h3>
<p>Initiate AOT compilation from the command line using the previously installed <code>ngc</code> compiler by executing:</p>
<code-example language="none" class="code-shell">node_modules/.bin/ngc -p tsconfig-aot.json</code-example><div class="l-sub-section"><p>Windows users should surround the <code>ngc</code> command in double quotes:</p>
<code-example format=".">"node_modules/.bin/ngc" -p tsconfig-aot.json</code-example></div><p><code>ngc</code> expects the <code>-p</code> switch to point to a <code>tsconfig.json</code> file or a folder containing a <code>tsconfig.json</code> file.</p>
<p>After <code>ngc</code> completes, look for a collection of <em>NgFactory</em> files in the <code>aot</code> folder (the folder specified as <code>genDir</code> in <code>tsconfig-aot.json</code>).</p>
<p>These factory files are essential to the compiled application.
Each component factory creates an instance of the component at runtime by combining the original class file
and a JavaScript representation of the component&#39;s template.
Note that the original component class is still referenced internally by the generated factory.</p>
<div class="l-sub-section"><p>The curious can open the <code>aot/app.component.ngfactory.ts</code> to see the original Angular template syntax
in its intermediate, compiled-to-TypeScript form.</p>
<p>JIT compilation generates these same <em>NgFactories</em> in memory where they are largely invisible.
AOT compilation reveals them as separate, physical files.</p>
</div><div class="alert is-important"><p>Do not edit the <em>NgFactories</em>! Re-compilation replaces these files and all edits will be lost.</p>
</div><a id="bootstrap"></a><div class="l-main-section"></div><h2 id="bootstrap">Bootstrap</h2>
<p>The AOT path changes application bootstrapping.</p>
<p>Instead of bootstrapping <code>AppModule</code>, you bootstrap the application with the generated module factory, <code>AppModuleNgFactory</code>.</p>
<p>Make a copy of <code>main.ts</code> and name it <code>main-jit.ts</code>.
This is the JIT version; set it aside as you may need it <a href="#run-jit" title="Running with JIT">later</a>.</p>
<p>Open <code>main.ts</code> and convert it to AOT compilation.
Switch from the <code>platformBrowserDynamic.bootstrap</code> used in JIT compilation to
<code>platformBrowser().bootstrapModuleFactory</code> and pass in the AOT-generated <code>AppModuleNgFactory</code>.</p>
<p>Here is AOT bootstrap in <code>main.ts</code> next to the original JIT version:</p>
<code-tabs><code-pane language="ts" name="src/main.ts" format="linenums">import { platformBrowser }    from &#39;@angular/platform-browser&#39;;
import { AppModuleNgFactory } from &#39;../aot/src/app/app.module.ngfactory&#39;;

console.log(&#39;Running AOT compiled&#39;);
platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);
</code-pane><code-pane language="ts" name="src/main-jit.ts" format="linenums">import { platformBrowserDynamic } from &#39;@angular/platform-browser-dynamic&#39;;
import { AppModule }              from &#39;./app/app.module&#39;;

console.log(&#39;Running JIT compiled&#39;);
platformBrowserDynamic().bootstrapModule(AppModule);
</code-pane></code-tabs><p>Be sure to recompile with <code>ngc</code>!</p>
<a id="tree-shaking"></a><h2 id="tree-shaking">Tree Shaking</h2>
<p>AOT compilation sets the stage for further optimization through a process called <em>Tree Shaking</em>.
A Tree Shaker walks the dependency graph, top to bottom, and <em>shakes out</em> unused code like
dead needles in a Christmas tree.</p>
<p>Tree Shaking can greatly reduce the downloaded size of the application
by removing unused portions of both source and library code.
In fact, most of the reduction in small apps comes from removing unreferenced Angular features.</p>
<p>For example, this demo application doesn&#39;t use anything from the <code>@angular/forms</code> library.
There is no reason to download Forms-related Angular code and tree shaking ensures that you don&#39;t.</p>
<p>Tree Shaking and AOT compilation are separate steps.
Tree Shaking can only target JavaScript code.
AOT compilation converts more of the application to JavaScript,
which in turn makes more of the application &quot;Tree Shakable&quot;.</p>
<h3 id="rollup">Rollup</h3>
<p>This cookbook illustrates a Tree Shaking utility called <em>Rollup</em>.</p>
<p>Rollup statically analyzes the application by following the trail of <code>import</code> and <code>export</code> statements.
It produces a final code <em>bundle</em> that excludes code that is exported, but never imported.</p>
<p>Rollup can only Tree Shake <code>ES2015</code> modules which have <code>import</code> and <code>export</code> statements.</p>
<div class="l-sub-section"><p>Recall that <code>tsconfig-aot.json</code> is configured to produce <code>ES2015</code> modules.
It&#39;s not important that the code itself be written with <code>ES2015</code> syntax such as <code>class</code> and <code>const</code>.
What matters is that the code uses ES <code>import</code> and <code>export</code> statements rather than <code>require</code> statements.</p>
</div><p>Install the Rollup dependencies with this command:</p>
<code-example format=".">npm install rollup rollup-plugin-node-resolve rollup-plugin-commonjs rollup-plugin-uglify --save-dev</code-example><p>Next, create a configuration file (<code>rollup-config.js</code>)
in the project root directory to tell Rollup how to process the application.
The cookbook configuration file looks like this.</p>
<div class="code-example"><header><h4>rollup-config.js</h4></header><code-example language="js" format="">import rollup      from &#39;rollup&#39;
import nodeResolve from &#39;rollup-plugin-node-resolve&#39;
import commonjs    from &#39;rollup-plugin-commonjs&#39;;
import uglify      from &#39;rollup-plugin-uglify&#39;

export default {
  entry: &#39;src/main.js&#39;,
  dest: &#39;src/build.js&#39;, // output a single application bundle
  sourceMap: false,
  format: &#39;iife&#39;,
  onwarn: function(warning) {
    // Skip certain warnings

    // should intercept ... but doesn&#39;t in some rollup versions
    if ( warning.code === &#39;THIS_IS_UNDEFINED&#39; ) { return; }
    // intercepts in some rollup versions
    if ( warning.indexOf(&quot;The &#39;this&#39; keyword is equivalent to &#39;undefined&#39;&quot;) &gt; -1 ) { return; }

    // console.warn everything else
    console.warn( warning.message );
  },
  plugins: [
      nodeResolve({jsnext: true, module: true}),
      commonjs({
        include: &#39;node_modules/rxjs/**&#39;,
      }),
      uglify()
  ]
}
</code-example></div><p>It tells Rollup that the app entry point is <code>src/app/main.js</code> .
The <code>dest</code> attribute tells Rollup to create a bundle called <code>build.js</code> in the <code>dist</code> folder.
It overrides the default <code>onwarn</code> method in order to skip annoying messages about the AOT compiler&#39;s use of the <code>this</code> keyword.</p>
<p>Then there are plugins.</p>
<h3 id="rollup-plugins">Rollup Plugins</h3>
<p>Optional plugins filter and transform the Rollup inputs and output.</p>
<p><em>RxJS</em>
Rollup expects application source code to use <code>ES2015</code> modules.
Not all external dependencies are published as <code>ES2015</code> modules.
In fact, most are not. Many of them are published as <em>CommonJS</em> modules.</p>
<p>The <em>RxJs</em> observable library is an essential Angular dependency published as an ES5 JavaScript <em>CommonJS</em> module.</p>
<p>Luckily there is a Rollup plugin that modifies <em>RxJs</em>
to use the ES <code>import</code> and <code>export</code> statements that Rollup requires.
Rollup then preserves in the final bundle the parts of <code>RxJS</code> referenced by the application.</p>
<div class="code-example"><header><h4>rollup-config.js (CommonJs to ES2015 Plugin)</h4></header><code-example language="js" format="">commonjs({
  include: &#39;node_modules/rxjs/**&#39;,
}),
</code-example></div><p><em>Minification</em></p>
<p>Rollup Tree Shaking reduces code size considerably.  Minification makes it smaller still.
This cookbook relies on the <em>uglify</em> Rollup plugin to minify and mangle the code.</p>
<div class="code-example"><header><h4>rollup-config.js (CommonJs to ES2015 Plugin)</h4></header><code-example language="js" format="">uglify()
</code-example></div><div class="l-sub-section"><p>In a production setting, you would also enable gzip on the web server to compress
the code into an even smaller package going over the wire.</p>
</div><h3 id="run-rollup">Run Rollup</h3>
<p>Execute the Rollup process with this command:</p>
<code-example format=".">node_modules/.bin/rollup -c rollup-config.js</code-example><div class="l-sub-section"><p>Windows users should surround the <code>rollup</code> command in double quotes:</p>
<code-example format=".">"node_modules/.bin/rollup"  -c rollup-config.js</code-example></div><a id="load"></a><div class="l-main-section"></div><h2 id="load-the-bundle">Load the Bundle</h2>
<p>Loading the generated application bundle does not require a module loader like SystemJS.
Remove the scripts that concern SystemJS.
Instead, load the bundle file using a single <code>script</code> tag <strong><em>after</em></strong> the <code>&lt;/body&gt;</code> tag:</p>
<div class="code-example"><header><h4>index.html (load bundle)</h4></header><code-example language="html" format="">&lt;script src=&quot;build.js&quot;&gt;&lt;/script&gt;
</code-example></div><a id="serve"></a><div class="l-main-section"></div><h2 id="serve-the-app">Serve the app</h2>
<p>You&#39;ll need a web server to host the application.
Use the same <em>Lite Server</em> employed elsewhere in the documentation:</p>
<code-example language="none" class="code-shell">npm run lite</code-example><p>The server starts, launches a browser, and the app should appear.</p>
<a id="source-code"></a><div class="l-main-section"></div><h2 id="aot-quickstart-source-code">AOT QuickStart Source Code</h2>
<p>Here&#39;s the pertinent source code:</p>
<code-tabs><code-pane language="html" name="src/app/app.component.html" format="linenums">&lt;button (click)=&quot;toggleHeading()&quot;&gt;Toggle Heading&lt;/button&gt;
&lt;h1 *ngIf=&quot;showHeading&quot;&gt;Hello Angular&lt;/h1&gt;

&lt;h3&gt;List of Heroes&lt;/h3&gt;
&lt;div *ngFor=&quot;let hero of heroes&quot;&gt;{{hero}}&lt;/div&gt;
</code-pane><code-pane language="ts" name="src/app/app.component.ts" format="linenums">import { Component } from &#39;@angular/core&#39;;

@Component({
  selector: &#39;my-app&#39;,
  templateUrl: &#39;./app.component.html&#39;
})
export class AppComponent {
  showHeading = true;
  heroes = [&#39;Magneta&#39;, &#39;Bombasto&#39;, &#39;Magma&#39;, &#39;Tornado&#39;];

  toggleHeading() {
    this.showHeading = !this.showHeading;
  }
}
</code-pane><code-pane language="ts" name="src/main.ts" format="linenums">import { platformBrowser }    from &#39;@angular/platform-browser&#39;;
import { AppModuleNgFactory } from &#39;../aot/src/app/app.module.ngfactory&#39;;

console.log(&#39;Running AOT compiled&#39;);
platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);
</code-pane><code-pane language="html" name="src/index.html" format="linenums">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ahead of time compilation&lt;/title&gt;
    &lt;base href=&quot;/&quot;&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;

    &lt;script src=&quot;node_modules/core-js/client/shim.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;node_modules/zone.js/dist/zone.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;my-app&gt;Loading...&lt;/my-app&gt;
  &lt;/body&gt;
  &lt;script src=&quot;build.js&quot;&gt;&lt;/script&gt;
&lt;/html&gt;
</code-pane><code-pane language="json" name="tsconfig-aot.json" format="linenums">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;es2015&quot;,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;sourceMap&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;lib&quot;: [&quot;es2015&quot;, &quot;dom&quot;],
    &quot;noImplicitAny&quot;: true,
    &quot;suppressImplicitAnyIndexErrors&quot;: true
  },

  &quot;files&quot;: [
    &quot;src/app/app.module.ts&quot;,
    &quot;src/main.ts&quot;
  ],

  &quot;angularCompilerOptions&quot;: {
   &quot;genDir&quot;: &quot;aot&quot;,
   &quot;skipMetadataEmit&quot; : true
 }
}
</code-pane><code-pane language="js" name="rollup-config.js" format="linenums">import rollup      from &#39;rollup&#39;
import nodeResolve from &#39;rollup-plugin-node-resolve&#39;
import commonjs    from &#39;rollup-plugin-commonjs&#39;;
import uglify      from &#39;rollup-plugin-uglify&#39;

export default {
  entry: &#39;src/main.js&#39;,
  dest: &#39;src/build.js&#39;, // output a single application bundle
  sourceMap: false,
  format: &#39;iife&#39;,
  onwarn: function(warning) {
    // Skip certain warnings

    // should intercept ... but doesn&#39;t in some rollup versions
    if ( warning.code === &#39;THIS_IS_UNDEFINED&#39; ) { return; }
    // intercepts in some rollup versions
    if ( warning.indexOf(&quot;The &#39;this&#39; keyword is equivalent to &#39;undefined&#39;&quot;) &gt; -1 ) { return; }

    // console.warn everything else
    console.warn( warning.message );
  },
  plugins: [
      nodeResolve({jsnext: true, module: true}),
      commonjs({
        include: &#39;node_modules/rxjs/**&#39;,
      }),
      uglify()
  ]
}
</code-pane></code-tabs><a id="workflow"></a><div class="l-main-section"></div><h2 id="workflow-and-convenience-script">Workflow and convenience script</h2>
<p>You&#39;ll rebuild the AOT version of the application every time you make a change.
Those <em>npm</em> commands are long and difficult to remember.</p>
<p>Add the following <em>npm</em> convenience script to the <code>package.json</code> so you can compile and rollup in one command.</p>
<div class="code-example"><header><h4>package.json (build:aot convenience script)</h4></header><code-example language="json" format="linenums">{
  "scripts": {
    "build:aot": "ngc -p tsconfig-aot.json && rollup -c rollup-config.js"
  }
}</code-example></div><p>Open a terminal window and try it.</p>
<code-example language="none" class="code-shell">npm run build:aot
</code-example><a id="run-jit"></a><h3 id="and-jit-too-">And JIT too!</h3>
<p>AOT compilation and rollup together take several seconds.
You may be able to develop iteratively a little faster with SystemJS and JIT.
The same source code can be built both ways. Here&#39;s one way to do that.</p>
<ul>
<li>Make a copy of <code>index.html</code> and call it <code>index-jit.html</code>.</li>
<li>Delete the script at the bottom of <code>index-jit.html</code> that loads <code>bundle.js</code></li>
<li>Restore the SystemJS scripts like this:</li>
</ul>
<div class="code-example"><header><h4>src/index-jit.html (SystemJS scripts)</h4></header><code-example language="html" format="">&lt;script src=&quot;node_modules/systemjs/dist/system.src.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;systemjs.config.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  System.import(&#39;main-jit.js&#39;).catch(function(err){ console.error(err); });
&lt;/script&gt;
</code-example></div><p>Notice the slight change to the <code>system.import</code> which now specifies <code>src/app/main-jit</code>.
That&#39;s the JIT version of the bootstrap file that we preserved <a href="#bootstrap">above</a></p>
<p>Open a <em>different</em> terminal window and enter.</p>
<code-example language="none" class="code-shell">npm start</code-example><p>That compiles the app with JIT and launches the server.
The server loads <code>index.html</code> which is still the AOT version (confirm in the browser console).
Change the address bar to <code>index-jit.html</code> and it loads the JIT version (confirm in the browser console).</p>
<p>Develop as usual.
The server and TypeScript compiler are in &quot;watch mode&quot; so your changes are reflected immediately in the browser.</p>
<p>To see those changes in AOT, switch to the original terminal and re-run <code>npm run build:aot</code>.
When it finishes, go back to the browser and back-button to the AOT version in the (default) <code>index.html</code>.</p>
<p>Now you can develop JIT and AOT, side-by-side.</p>
<a id="toh"></a><div class="l-main-section"></div><h2 id="tour-of-heroes">Tour of Heroes</h2>
<p>The sample above is a trivial variation of the QuickStart app.
In this section you apply what you&#39;ve learned about AOT compilation and Tree Shaking
to an app with more substance, the tutorial <a href="../tutorial/toh-pt6.html"><em>Tour of Heroes</em></a>.</p>
<h3 id="jit-in-development-aot-in-production">JIT in development, AOT in production</h3>
<p>Today AOT compilation and Tree Shaking take more time than is practical for development. That will change soon.
For now, it&#39;s best to JIT compile in development and switch to AOT compilation before deploying to production.</p>
<p>Fortunately, the source code can be compiled either way without change <em>if</em> you account for a few key differences.</p>
<p><strong><em>index.html</em></strong></p>
<p>The JIT and AOT apps require their own <code>index.html</code> files because they setup and launch so differently.</p>
<p>Here they are for comparison:</p>
<code-tabs><code-pane language="html" name="aot/index.html (AOT)" format="linenums">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base href=&quot;/&quot;&gt;
    &lt;title&gt;Angular Tour of Heroes&lt;/title&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;

    &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;

    &lt;script src=&quot;shim.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;zone.min.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;my-app&gt;Loading...&lt;/my-app&gt;
  &lt;/body&gt;
  &lt;script src=&quot;dist/build.js&quot;&gt;&lt;/script&gt;
&lt;/html&gt;
</code-pane><code-pane language="html" name="src/index.html (JIT)" format="linenums">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base href=&quot;/&quot;&gt;
    &lt;title&gt;Angular Tour of Heroes&lt;/title&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;

    &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;

    &lt;!-- Polyfills --&gt;
    &lt;script src=&quot;node_modules/core-js/client/shim.min.js&quot;&gt;&lt;/script&gt;

    &lt;script src=&quot;node_modules/zone.js/dist/zone.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;node_modules/systemjs/dist/system.src.js&quot;&gt;&lt;/script&gt;

    &lt;script src=&quot;systemjs.config.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
      System.import(&#39;main.js&#39;).catch(function(err){ console.error(err); });
    &lt;/script&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;my-app&gt;Loading...&lt;/my-app&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code-pane></code-tabs><p>The JIT version relies on <code>SystemJS</code> to load individual modules.
Its scripts appear in its <code>index.html</code>.</p>
<p>The AOT version loads the entire application in a single script, <code>aot/dist/build.js</code>.
It does not need <code>SystemJS</code>, so that script is absent from its <code>index.html</code></p>
<p><strong><em>main.ts</em></strong></p>
<p>JIT and AOT applications boot in much the same way but require different Angular libraries to do so.
The key differences, covered in the <a href="#bootstrap">Bootstrap</a> section above,
are evident in these <code>main</code> files which can and should reside in the same folder:</p>
<code-tabs><code-pane language="ts" name="main-aot.ts (AOT)" format="linenums">import { platformBrowser }    from &#39;@angular/platform-browser&#39;;

import { AppModuleNgFactory } from &#39;../aot/src/app/app.module.ngfactory&#39;;

platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);
</code-pane><code-pane language="ts" name="main.ts (JIT)" format="linenums">import { platformBrowserDynamic } from &#39;@angular/platform-browser-dynamic&#39;;

import { AppModule } from &#39;./app/app.module&#39;;

platformBrowserDynamic().bootstrapModule(AppModule);
</code-pane></code-tabs><p><strong><em>TypeScript configuration</em></strong></p>
<p>JIT-compiled applications transpile to <code>commonjs</code> modules.
AOT-compiled applications transpile to <em>ES2015</em>/<em>ES6</em> modules to facilitate Tree Shaking.
AOT requires its own TypeScript configuration settings as well.</p>
<p>You&#39;ll need separate TypeScript configuration files such as these:</p>
<code-tabs><code-pane language="json" name="tsconfig-aot.json (AOT)" format="linenums">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;es2015&quot;,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;sourceMap&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;lib&quot;: [&quot;es2015&quot;, &quot;dom&quot;],
    &quot;noImplicitAny&quot;: true,
    &quot;suppressImplicitAnyIndexErrors&quot;: true,
    &quot;typeRoots&quot;: [
      &quot;../../node_modules/@types/&quot;
    ]
  },

  &quot;files&quot;: [
    &quot;src/app/app.module.ts&quot;,
    &quot;src/main-aot.ts&quot;
  ],

  &quot;angularCompilerOptions&quot;: {
    &quot;genDir&quot;: &quot;aot&quot;,
    &quot;skipMetadataEmit&quot; : true
  }
}
</code-pane><code-pane language="json" name="src/tsconfig.json (JIT)" format="linenums">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;sourceMap&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;lib&quot;: [ &quot;es2015&quot;, &quot;dom&quot; ],
    &quot;noImplicitAny&quot;: true,
    &quot;suppressImplicitAnyIndexErrors&quot;: true
  }
}
</code-pane></code-tabs><div class="callout is-helpful"><header>@Types and node modules</header><p>In the file structure of <em>this particular sample project</em>,
the <code>node_modules</code> folder happens to be two levels up from the project root.
Therefore, <code>&quot;typeRoots&quot;</code> must be set to <code>&quot;../../node_modules/@types/&quot;</code>.</p>
<p>In a more typical project, <code>node_modules</code> would be a sibling of <code>tsconfig-aot.json</code>
and <code>&quot;typeRoots&quot;</code> would be set to <code>&quot;node_modules/@types/&quot;</code>.
Edit your <code>tsconfig-aot.json</code> to fit your project&#39;s file structure.</p>
</div><h3 id="tree-shaking">Tree Shaking</h3>
<p>Rollup does the Tree Shaking as before.</p>
<div class="code-example"><header><h4>rollup-config.js</h4></header><code-example language="js" format="">import rollup      from &#39;rollup&#39;
import nodeResolve from &#39;rollup-plugin-node-resolve&#39;
import commonjs    from &#39;rollup-plugin-commonjs&#39;;
import uglify      from &#39;rollup-plugin-uglify&#39;

//paths are relative to the execution path
export default {
  entry: &#39;src/main-aot.js&#39;,
  dest: &#39;aot/dist/build.js&#39;, // output a single application bundle
  sourceMap: true,
  sourceMapFile: &#39;aot/dist/build.js.map&#39;,
  format: &#39;iife&#39;,
  onwarn: function(warning) {
    // Skip certain warnings

    // should intercept ... but doesn&#39;t in some rollup versions
    if ( warning.code === &#39;THIS_IS_UNDEFINED&#39; ) { return; }
    // intercepts in some rollup versions
    if ( warning.indexOf(&quot;The &#39;this&#39; keyword is equivalent to &#39;undefined&#39;&quot;) &gt; -1 ) { return; }

    // console.warn everything else
    console.warn( warning.message );
  },
  plugins: [
    nodeResolve({jsnext: true, module: true}),
    commonjs({
      include: [&#39;node_modules/rxjs/**&#39;]
    }),
    uglify()
  ]
}
</code-example></div><h3 id="running-the-application">Running the application</h3>
<div class="alert is-important"><p>The general audience instructions for running the AOT build of the Tour of Heroes app are not ready.</p>
<p>The following instructions presuppose that you have cloned the
<a href="https://github.com/angular/angular.io" target="_blank">angular.io</a>
github repository and prepared it for development as explained in the repo&#39;s README.md.</p>
<p>The <em>Tour of Heroes</em> source code is in the <code>public/docs/_examples/toh-6/ts</code> folder.</p>
</div><p>Run the JIT-compiled app with <code>npm start</code> as for all other JIT examples.</p>
<p>Compiling with AOT presupposes certain supporting files, most of them discussed above.</p>
<code-tabs><code-pane language="html" name="src/index.html" format="linenums">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base href=&quot;/&quot;&gt;
    &lt;title&gt;Angular Tour of Heroes&lt;/title&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;

    &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;

    &lt;!-- Polyfills --&gt;
    &lt;script src=&quot;node_modules/core-js/client/shim.min.js&quot;&gt;&lt;/script&gt;

    &lt;script src=&quot;node_modules/zone.js/dist/zone.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;node_modules/systemjs/dist/system.src.js&quot;&gt;&lt;/script&gt;

    &lt;script src=&quot;systemjs.config.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
      System.import(&#39;main.js&#39;).catch(function(err){ console.error(err); });
    &lt;/script&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;my-app&gt;Loading...&lt;/my-app&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code-pane><code-pane language="js" name="copy-dist-files.js" format="linenums">var fs = require(&#39;fs&#39;);
var resources = [
  &#39;node_modules/core-js/client/shim.min.js&#39;,
  &#39;node_modules/zone.js/dist/zone.min.js&#39;,
  &#39;src/styles.css&#39;
];
resources.map(function(f) {
  var path = f.split(&#39;/&#39;);
  var t = &#39;aot/&#39; + path[path.length-1];
  fs.createReadStream(f).pipe(fs.createWriteStream(t));
});
</code-pane><code-pane language="js" name="rollup-config.js" format="linenums">import rollup      from &#39;rollup&#39;
import nodeResolve from &#39;rollup-plugin-node-resolve&#39;
import commonjs    from &#39;rollup-plugin-commonjs&#39;;
import uglify      from &#39;rollup-plugin-uglify&#39;

//paths are relative to the execution path
export default {
  entry: &#39;src/main-aot.js&#39;,
  dest: &#39;aot/dist/build.js&#39;, // output a single application bundle
  sourceMap: true,
  sourceMapFile: &#39;aot/dist/build.js.map&#39;,
  format: &#39;iife&#39;,
  onwarn: function(warning) {
    // Skip certain warnings

    // should intercept ... but doesn&#39;t in some rollup versions
    if ( warning.code === &#39;THIS_IS_UNDEFINED&#39; ) { return; }
    // intercepts in some rollup versions
    if ( warning.indexOf(&quot;The &#39;this&#39; keyword is equivalent to &#39;undefined&#39;&quot;) &gt; -1 ) { return; }

    // console.warn everything else
    console.warn( warning.message );
  },
  plugins: [
    nodeResolve({jsnext: true, module: true}),
    commonjs({
      include: [&#39;node_modules/rxjs/**&#39;]
    }),
    uglify()
  ]
}
</code-pane><code-pane language="json" name="tsconfig-aot.json" format="linenums">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;es2015&quot;,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;sourceMap&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;lib&quot;: [&quot;es2015&quot;, &quot;dom&quot;],
    &quot;noImplicitAny&quot;: true,
    &quot;suppressImplicitAnyIndexErrors&quot;: true,
    &quot;typeRoots&quot;: [
      &quot;../../node_modules/@types/&quot;
    ]
  },

  &quot;files&quot;: [
    &quot;src/app/app.module.ts&quot;,
    &quot;src/main-aot.ts&quot;
  ],

  &quot;angularCompilerOptions&quot;: {
    &quot;genDir&quot;: &quot;aot&quot;,
    &quot;skipMetadataEmit&quot; : true
  }
}
</code-pane></code-tabs><p>Extend the <code>scripts</code> section of the <code>package.json</code> with these npm scripts:</p>
<div class="code-example"><header><h4>package.json (convenience scripts)</h4></header><code-example language="json" format="linenums">{
  "scripts": {
    "build:aot": "ngc -p tsconfig-aot.json && rollup -c rollup-config.js",
    "serve:aot": "lite-server -c bs-config.aot.json"
  }
}</code-example></div><p>Copy the AOT distribution files into the <code>/aot</code> folder with the node script:</p>
<code-example language="none" class="code-shell">node copy-dist-files</code-example><div class="l-sub-section"><p>You won&#39;t do that again until there are updates to <code>zone.js</code> or the <code>core-js</code> shim for old browsers.</p>
</div><p>Now AOT-compile the app and launch it with the <code>lite</code> server:</p>
<code-example language="none" class="code-shell">npm run build:aot && npm run serve:aot
</code-example><h3 id="inspect-the-bundle">Inspect the Bundle</h3>
<p>It&#39;s fascinating to see what the generated JavaScript bundle looks like after Rollup.
The code is minified, so you won&#39;t learn much from inspecting the bundle directly.
But the <a href="https://github.com/danvk/source-map-explorer/blob/master/README.md" target="_blank">source-map-explorer</a>
tool can be quite revealing.</p>
<p>Install it:</p>
<code-example language="none" class="code-shell">npm install source-map-explorer --save-dev</code-example><p>Run the following command to generate the map.</p>
<code-example language="none" class="code-shell">node_modules/.bin/source-map-explorer aot/dist/build.js
</code-example><p>The <code>source-map-explorer</code> analyzes the source map generated with the bundle and draws a map of all dependencies,
showing exactly which application and Angular modules and classes are included in the bundle.</p>
<p>Here&#39;s the map for <em>Tour of Heroes</em>.</p>
<a href="/resources/images/cookbooks/aot-compiler/toh6-bundle.png" target="_blank" title="View larger image"><figure class="image-display"><img src="/resources/images/cookbooks/aot-compiler/toh6-bundle.png" alt="TOH-6-bundle"></figure></a></article><div data-swiftype-index="false" class="main-footer"><nav class="background-midnight grid-fluid"><div class="c3 main-footer-branding"><div class="logo-inverse-large"></div></div><div class="c2"><h3 class="text-headline">RESOURCES</h3><ul class="text-body"><!-- TODO: (ericjim) make a libraries page to showcase all angular libraries--><!--li <a href="/libraries.html">Libraries</a>--><li><a href="/about/">About</a></li><li><a href="/resources/#Education">Books & Training</a></li><li><a href="/resources/">Tools & Libraries</a></li><li><a href="/resources/">Community</a></li><li><a href="/presskit.html">Press Kit</a></li></ul></div><div class="c2"><h3 class="text-headline">HELP</h3><ul class="text-body"><li><a href="http://stackoverflow.com/questions/tagged/angular2">Stack Overflow</a></li><li><a href="https://gitter.im/angular/angular">Gitter</a></li><li><a href="https://groups.google.com/forum/#!forum/angular"> Google Group</a></li><li><a href="https://github.com/angular/angular/issues"> Report Issues</a></li><li><a class="footer-feedback" ng-click="appCtrl.openFeedback()" aria-label="Submit feedback on this page"> Site Feedback</a></li></ul></div><div class="c2"><h3 class="text-headline">COMMUNITY</h3><ul class="text-body"><li><a href="/events.html">Events</a></li><li><a href="http://www.meetup.com/topics/angularjs/">Meetups</a></li><li><a href="https://twitter.com/angular"> Twitter</a></li><li><a href="https://github.com/angular/angular"> GitHub</a></li><li><a href="/contribute.html"> Contribute</a></li></ul></div><div class="c2"><h3 class="text-headline">LANGUAGES</h3><ul class="text-body"><li><a href="https://angular.cn/">中文版</a></li></ul></div></nav><footer class="background-midnight"><small class="text-caption">Powered by Google ©2010-2017. Code licensed under an <a href="/license">MIT-style License</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</small><a aria-label="View Style Guide" href="/docs/ts/latest/styleguide.html" title="Style Guide" class="styleguide-trigger"><span class="icon-favorite"></span></a></footer></div><!-- VENDORS --><script src="/resources/js/vendor/prettify.js"></script><script src="/resources/js/vendor/lang-basic.js"></script><script src="/resources/js/vendor/lang-dart.js"></script><script src="/resources/js/vendor/lodash.js"></script><script src="/resources/js/vendor/clipboard.min.js"></script><!-- Angular Material Dependencies --><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0/angular.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0/angular-animate.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0/angular-aria.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.js"></script><!-- Firebase -->
<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
<!-- AngularFire -->
<script src="https://cdn.firebase.com/libs/angularfire/1.2.0/angularfire.min.js"></script>
<!-- Angular.io Site JS --><script src="/resources/js/site.js"></script><script src="/resources/js/util.js"></script><script src="/resources/js/controllers/app-controller.js"></script><script src="/resources/js/controllers/resources-controller.js"></script><script src="/resources/js/directives/cheatsheet.js"></script><script src="/resources/js/directives/api-list.js"></script><script src="/resources/js/directives/bio.js"></script><script src="/resources/js/directives/bold.js"></script><script src="/resources/js/directives/announcement-bar.js"></script><script src="/resources/js/directives/code.js"></script><script src="/resources/js/directives/copy.js"></script><script src="/resources/js/directives/code-tabs.js"></script><script src="/resources/js/directives/code-pane.js"></script><script src="/resources/js/directives/code-example.js"></script><script src="/resources/js/directives/if-docs.js"></script><script src="/resources/js/directives/live-example.js"></script><script src="/resources/js/directives/ngio-ex-path.js"></script><script src="/resources/js/directives/scroll-y-offset-element.js"></script><!-- GA --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8594346-15', 'auto');
ga('send', 'pageview')
</script><!-- SWIFTYPE --><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','VsuU7kH5Hnnj9tfyNvfK','2.0.0');

</script><!-- Google Feedback --><script src="//www.gstatic.com/feedback/api.js" type="text/javascript"></script><!-- Twitter Widget --><script>(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}})(document,"script","twitter-wjs");</script></body></html>